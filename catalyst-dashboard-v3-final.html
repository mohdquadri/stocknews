<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CATALYST ‚Äî AI-Powered Stock Intelligence Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#0a0b0d; --surface:#111318; --surface2:#191c24; --border:#1a1d28;
  --accent:#00ff88; --red:#ff4444; --yellow:#ffaa00; --blue:#4488ff;
  --grok:#ff006e; --grok-dim:#330016;
  --text:#e8eaf0; --muted:#4a506a; --dim:#3a3f52;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;min-height:100vh;}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(255,255,255,0.007) 2px,rgba(255,255,255,0.007) 4px);pointer-events:none;z-index:999;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
a{color:inherit;text-decoration:none;}a:hover{color:var(--accent);}
select option{background:#111318;}

header{border-bottom:1px solid var(--border);padding:0 28px;height:68px;display:flex;align-items:center;justify-content:space-between;background:rgba(10,11,13,0.97);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px);}
.logo-group{display:flex;align-items:center;gap:16px;}
.logo{font-family:'Bebas Neue';font-size:22px;letter-spacing:.15em;color:var(--accent);text-shadow:0 0 24px rgba(0,255,136,.35);}
.logo span{color:var(--dim);}
.ai-badge{display:flex;align-items:center;gap:8px;padding:6px 12px;border-radius:8px;background:linear-gradient(135deg, rgba(255,0,110,.12), rgba(255,0,110,.05));border:1px solid rgba(255,0,110,.25);font-family:'DM Mono';font-size:10px;letter-spacing:.15em;color:var(--grok);}
.grok-icon{width:18px;height:18px;display:flex;align-items:center;justify-content:center;font-size:14px;}
.header-right{display:flex;align-items:center;gap:20px;}
.live{display:flex;align-items:center;gap:8px;font-family:'DM Mono';font-size:10px;color:var(--dim);letter-spacing:.12em;}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--accent);box-shadow:0 0 8px var(--accent);animation:pulse 2s infinite;}
.live-dot.scanning{background:var(--grok);box-shadow:0 0 12px var(--grok);}
.window-badge{font-family:'DM Mono';font-size:10px;padding:4px 10px;border-radius:4px;background:rgba(0,255,136,.08);border:1px solid rgba(0,255,136,.2);color:var(--accent);letter-spacing:.1em;}

/* Tab Navigation */
.tab-nav{display:flex;gap:0;border-bottom:1px solid var(--border);background:var(--surface);padding:0 28px;}
.tab-btn{font-family:'DM Mono';font-size:12px;padding:16px 24px;cursor:pointer;border:none;background:transparent;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;position:relative;transition:all .2s;}
.tab-btn:hover{color:var(--text);background:rgba(255,255,255,.02);}
.tab-btn.active{color:var(--accent);}
.tab-btn.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--accent);box-shadow:0 0 8px var(--accent);}

.tab-content{display:none;}
.tab-content.active{display:block;}

main{max-width:1120px;margin:0 auto;padding:20px 20px 48px;}

.grok-banner{background:linear-gradient(135deg, rgba(255,0,110,.08), rgba(255,0,110,.02));border:1px solid rgba(255,0,110,.2);border-radius:12px;padding:18px 24px;margin-bottom:16px;display:flex;align-items:center;gap:18px;position:relative;overflow:hidden;}
.grok-banner::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--grok),transparent);}
.grok-avatar{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg, #ff006e, #ff4488);display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 0 20px rgba(255,0,110,.4);}
.grok-info{flex:1;}
.grok-title{font-family:'Bebas Neue';font-size:16px;letter-spacing:.12em;color:var(--grok);margin-bottom:4px;}
.grok-desc{font-size:12px;color:var(--muted);line-height:1.5;}
.grok-status{font-family:'DM Mono';font-size:10px;padding:4px 10px;border-radius:4px;background:rgba(0,255,136,.08);border:1px solid rgba(0,255,136,.2);color:var(--accent);letter-spacing:.1em;white-space:nowrap;}

.config{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:22px 26px;margin-bottom:16px;position:relative;overflow:hidden;}
.config::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--accent),transparent);}
.section-label{font-family:'DM Mono';font-size:10px;letter-spacing:.2em;color:var(--dim);text-transform:uppercase;margin-bottom:16px;}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end;}
.field{display:flex;flex-direction:column;gap:6px;}
.field label{font-family:'DM Mono';font-size:10px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;}
.field input,.field select{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 14px;color:var(--text);font-family:'DM Sans';font-size:13px;outline:none;transition:border-color .2s;}
.field input:focus,.field select:focus{border-color:var(--accent);box-shadow:0 0 0 2px rgba(0,255,136,.1);}
.field-ticker{flex:1 1 240px;}
.field-ticker input{width:100%;}
.field-hint{font-family:'DM Mono';font-size:10px;color:var(--dim);margin-top:4px;}
.field-sm select{width:180px;}
.time-toggle{display:flex;gap:0;border-radius:8px;overflow:hidden;border:1px solid var(--border);}
.time-opt{font-family:'DM Mono';font-size:11px;padding:10px 12px;cursor:pointer;transition:all .15s;letter-spacing:.07em;border:none;outline:none;background:var(--surface2);color:var(--muted);white-space:nowrap;}
.time-opt:not(:last-child){border-right:1px solid var(--border);}
.time-opt.active{background:rgba(0,255,136,.12);color:var(--accent);}
.time-opt:hover:not(.active){background:var(--surface);color:var(--text);}
.btn-run{background:linear-gradient(135deg, var(--grok), #ff3388);color:#fff;border:none;border-radius:8px;padding:10px 26px;font-family:'DM Mono';font-size:12px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s;white-space:nowrap;align-self:flex-end;box-shadow:0 4px 16px rgba(255,0,110,.3);}
.btn-run:hover:not(:disabled){background:linear-gradient(135deg, #ff1a7a, #ff4499);transform:translateY(-1px);box-shadow:0 6px 24px rgba(255,0,110,.5);}
.btn-run:disabled{opacity:.5;cursor:not-allowed;}

.kw-section{margin-top:18px;padding-top:16px;border-top:1px solid var(--border);}
.kw-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.kw-header-left{font-family:'DM Mono';font-size:10px;color:var(--dim);letter-spacing:.15em;text-transform:uppercase;}
.kw-section-title{font-family:'DM Mono';font-size:9px;color:var(--accent);letter-spacing:.2em;text-transform:uppercase;margin-top:16px;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid rgba(0,255,136,.15);display:flex;align-items:center;justify-content:space-between;}
.section-toggle-btn{font-family:'DM Mono';font-size:9px;padding:3px 10px;border-radius:4px;border:1px solid var(--border);color:var(--muted);cursor:pointer;background:transparent;letter-spacing:.06em;transition:all .2s;text-transform:uppercase;}
.section-toggle-btn:hover{border-color:var(--accent);color:var(--accent);background:rgba(0,255,136,.05);}
.section-toggle-btn.active{border-color:var(--accent);color:var(--accent);background:rgba(0,255,136,.08);}
.kw-controls{display:flex;gap:8px;}
.kw-btn{font-family:'DM Mono';font-size:9px;padding:3px 8px;border-radius:3px;border:1px solid var(--border);color:var(--muted);cursor:pointer;background:transparent;letter-spacing:.05em;transition:all .15s;}
.kw-btn:hover{border-color:var(--accent);color:var(--accent);}
.kw-grid{display:flex;flex-wrap:wrap;gap:6px;}
.chip{font-family:'DM Mono';font-size:10px;padding:4px 9px;border-radius:4px;border:1px solid var(--border);color:var(--muted);letter-spacing:.05em;text-transform:uppercase;cursor:pointer;transition:all .15s;user-select:none;}
.chip.earn-on{background:rgba(255,170,0,.1); border-color:rgba(255,170,0,.4); color:var(--yellow);}
.chip.fda-on{background:rgba(0,255,136,.1); border-color:rgba(0,255,136,.4); color:var(--accent);}
.chip.deal-on{background:rgba(68,136,255,.1);border-color:rgba(68,136,255,.35);color:#77aaff;}
.chip.ma-on{background:rgba(255,0,110,.1);border-color:rgba(255,0,110,.4);color:var(--grok);}
.chip.macro-on{background:rgba(147,51,234,.1);border-color:rgba(147,51,234,.4);color:#9333ea;}
.chip.viral-on{background:rgba(255,68,68,.12); border-color:rgba(255,68,68,.4); color:var(--red);}
.chip:not([class*="-on"]){opacity:.28;}

.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px;animation:fadeUp .4s ease;}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 18px;position:relative;overflow:hidden;}
.stat::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;}
.stat.g::after{background:var(--accent);}.stat.b::after{background:var(--blue);}.stat.r::after{background:var(--red);}.stat.y::after{background:var(--yellow);}
.stat-label{font-family:'DM Mono';font-size:9px;letter-spacing:.15em;color:var(--dim);text-transform:uppercase;margin-bottom:6px;}
.stat-val{font-family:'Bebas Neue';font-size:34px;line-height:1;}
.stat.g .stat-val{color:var(--accent);}.stat.b .stat-val{color:var(--blue);}.stat.r .stat-val{color:var(--red);}.stat.y .stat-val{color:var(--yellow);}

.results-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.results-title{font-family:'Bebas Neue';font-size:18px;letter-spacing:.12em;color:#5a5f72;}
.sort-label{font-family:'DM Mono';font-size:10px;color:var(--dim);letter-spacing:.1em;}

.news-grid{display:flex;flex-direction:column;gap:8px;}
.card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 20px;transition:all .2s;animation:fadeUp .35s ease both;}
.card:hover{background:var(--surface2);transform:translateX(4px);border-color:rgba(255,255,255,.1);}
.card-top{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;margin-bottom:10px;}
.card-tags{display:flex;align-items:center;gap:7px;flex-wrap:wrap;}
.ticker-badge{font-family:'DM Mono';font-size:11px;padding:3px 8px;border-radius:4px;background:rgba(0,255,136,.1);color:var(--accent);border:1px solid rgba(0,255,136,.25);letter-spacing:.05em;}
.cat-tag{font-family:'DM Mono';font-size:10px;padding:3px 7px;border-radius:3px;text-transform:uppercase;letter-spacing:.05em;}
.kw-tag{font-family:'DM Mono';font-size:10px;padding:3px 7px;border-radius:3px;border:1px solid var(--border);color:var(--muted);text-transform:uppercase;letter-spacing:.04em;}
.mcap{font-family:'DM Mono';font-size:10px;color:var(--dim);white-space:nowrap;}
.card-title{font-size:15px;font-weight:600;line-height:1.4;color:#dde0ea;margin-bottom:8px;}
.card-summary{font-size:13px;color:#7a80a0;line-height:1.65;margin-bottom:12px;}
.card-footer{display:flex;justify-content:space-between;align-items:center;gap:12px;}
.card-meta{display:flex;align-items:center;gap:7px;font-family:'DM Mono';font-size:10px;color:var(--muted);flex-wrap:wrap;}
.sep{width:3px;height:3px;border-radius:50%;background:var(--border);display:inline-block;flex-shrink:0;}
.time-ago{font-family:'DM Mono';font-size:10px;padding:2px 6px;border-radius:3px;background:rgba(0,255,136,.06);color:var(--accent);border:1px solid rgba(0,255,136,.15);}
.source-link{font-family:'DM Mono';font-size:10px;padding:3px 8px;border-radius:4px;background:rgba(68,136,255,.08);color:var(--blue);border:1px solid rgba(68,136,255,.2);cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:4px;}
.source-link:hover{background:rgba(68,136,255,.15);border-color:rgba(68,136,255,.4);transform:translateX(2px);}
.impact-wrap{display:flex;align-items:center;gap:8px;flex-shrink:0;}
.impact-label{font-family:'DM Mono';font-size:9px;text-transform:uppercase;letter-spacing:.1em;}
.impact-bar{width:56px;height:3px;background:var(--border);border-radius:2px;overflow:hidden;}
.impact-fill{height:100%;border-radius:2px;}

.sentiment-section{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 20px;margin-bottom:16px;}
.sentiment-title{font-size:15px;font-weight:600;line-height:1.4;color:#dde0ea;margin-bottom:8px;}
.sentiment-category{font-family:'DM Mono';font-size:12px;padding:4px 10px;border-radius:4px;margin-right:8px;}
.sentiment-positive{background:rgba(0,255,136,.1);border:1px solid rgba(0,255,136,.25);color:var(--accent);}
.sentiment-neutral{background:rgba(255,170,0,.1);border:1px solid rgba(255,170,0,.25);color:var(--yellow);}
.sentiment-negative{background:rgba(255,68,68,.1);border:1px solid rgba(255,68,68,.25);color:var(--red);}
.sentiment-score{font-family:'DM Mono';font-size:12px;color:var(--muted);margin-right:8px;}
.sentiment-rationale{font-size:13px;color:#7a80a0;line-height:1.65;}

.financial-table{width:100%;border-collapse:collapse;margin-bottom:16px;}
.financial-table th,.financial-table td{padding:10px 14px;border:1px solid var(--border);font-size:13px;}
.financial-table th{background:var(--surface2);font-family:'DM Mono';font-size:11px;text-transform:uppercase;letter-spacing:.1em;color:var(--dim);text-align:left;}
.financial-table td{color:var(--text);}

.analysis-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:16px;}
.analysis-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:18px 22px;}
.analysis-card-title{font-family:'Bebas Neue';font-size:16px;letter-spacing:.1em;color:var(--accent);margin-bottom:12px;}
.analysis-content{font-size:13px;color:#7a80a0;line-height:1.65;}
.metric-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--border);}
.metric-row:last-child{border-bottom:none;}
.metric-label{font-family:'DM Mono';font-size:11px;color:var(--muted);text-transform:uppercase;}
.metric-value{font-family:'DM Mono';font-size:13px;color:var(--text);}

.state-box{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:52px 24px;text-align:center;}
.state-icon{font-size:42px;margin-bottom:14px;opacity:.3;}
.state-title{font-family:'Bebas Neue';font-size:20px;letter-spacing:.1em;color:#5a5f72;margin-bottom:8px;}
.state-sub{font-size:13px;color:var(--muted);line-height:1.7;}
.spinner{width:44px;height:44px;border:2px solid var(--border);border-top-color:var(--grok);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 20px;}
.loading-msg{font-family:'DM Mono';font-size:11px;color:var(--dim);letter-spacing:.15em;text-transform:uppercase;margin-bottom:8px;}
.err-box{background:rgba(255,68,68,.05);border:1px solid rgba(255,68,68,.2);border-radius:8px;padding:12px 16px;color:var(--red);font-family:'DM Mono';font-size:11px;letter-spacing:.03em;margin-bottom:12px;}

.grok-thinking{display:flex;align-items:center;gap:8px;font-family:'DM Mono';font-size:11px;color:var(--grok);padding:12px 16px;background:rgba(255,0,110,.05);border:1px solid rgba(255,0,110,.15);border-radius:8px;margin-bottom:12px;}
.thinking-dots{display:flex;gap:4px;}
.thinking-dots span{width:4px;height:4px;border-radius:50%;background:var(--grok);animation:bounce .6s infinite;}
.thinking-dots span:nth-child(2){animation-delay:.15s;}
.thinking-dots span:nth-child(3){animation-delay:.3s;}

/* Technical Analysis Styles */
.technical-overview{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;}
.technical-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;position:relative;}
.technical-card-title{font-family:'DM Mono';font-size:10px;letter-spacing:.15em;color:var(--dim);text-transform:uppercase;margin-bottom:10px;}
.technical-value{font-family:'Bebas Neue';font-size:28px;line-height:1;margin-bottom:6px;}
.technical-value.bullish{color:var(--accent);}
.technical-value.bearish{color:var(--red);}
.technical-value.neutral{color:var(--yellow);}
.technical-subtitle{font-family:'DM Mono';font-size:11px;color:var(--muted);}
.indicator-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px;}
.indicator-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 20px;}
.indicator-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
.indicator-name{font-family:'Bebas Neue';font-size:16px;letter-spacing:.1em;color:var(--accent);}
.indicator-signal{font-family:'DM Mono';font-size:11px;padding:4px 10px;border-radius:4px;}
.signal-bullish{background:rgba(0,255,136,.12);color:var(--accent);border:1px solid rgba(0,255,136,.25);}
.signal-bearish{background:rgba(255,68,68,.12);color:var(--red);border:1px solid rgba(255,68,68,.25);}
.signal-neutral{background:rgba(255,170,0,.12);color:var(--yellow);border:1px solid rgba(255,170,0,.25);}
.indicator-details{font-size:13px;color:#7a80a0;line-height:1.65;}
.indicator-metric{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.04);}
.indicator-metric:last-child{border:none;}
.metric-name{font-family:'DM Mono';font-size:11px;color:var(--muted);}
.metric-val{font-family:'DM Mono';font-size:12px;color:var(--text);}
.chart-container{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:20px;margin-bottom:16px;}
.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.chart-title{font-family:'Bebas Neue';font-size:18px;letter-spacing:.12em;color:#5a5f72;}
.chart-embed{background:var(--surface2);border:1px solid var(--border);border-radius:8px;overflow:hidden;}
.chart-embed iframe{width:100%;height:100%;border:none;}
.pattern-section{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:18px 22px;margin-bottom:16px;}
.pattern-title{font-family:'Bebas Neue';font-size:16px;letter-spacing:.1em;color:var(--accent);margin-bottom:12px;}
.pattern-list{list-style:none;padding:0;}
.pattern-item{padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px;color:#7a80a0;display:flex;align-items:center;gap:8px;}
.pattern-item:last-child{border:none;}
.pattern-icon{font-size:16px;}
.summary-card{background:linear-gradient(135deg, rgba(0,255,136,.08), rgba(0,255,136,.02));border:1px solid rgba(0,255,136,.2);border-radius:12px;padding:20px 26px;margin-bottom:16px;}
.summary-card-title{font-family:'Bebas Neue';font-size:18px;letter-spacing:.12em;color:var(--accent);margin-bottom:12px;}
.summary-content{font-size:14px;color:#dde0ea;line-height:1.7;}
.trend-badge{display:inline-block;font-family:'DM Mono';font-size:11px;padding:4px 12px;border-radius:4px;margin-left:8px;}
.copy-ticker-btn{background:rgba(68,136,255,.08);color:var(--blue);border:1px solid rgba(68,136,255,.2);border-radius:6px;padding:6px 12px;font-family:'DM Mono';font-size:10px;cursor:pointer;transition:all .2s;letter-spacing:.06em;}
.copy-ticker-btn:hover{background:rgba(68,136,255,.15);border-color:rgba(68,136,255,.4);}

@keyframes spin{to{transform:rotate(360deg);}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.3;}}
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
@media(max-width:640px){
  .stats{grid-template-columns:repeat(2,1fr);}
  .controls{flex-direction:column;}
  .field-sm select{width:100%;}
  .analysis-grid{grid-template-columns:1fr;}
  .technical-overview{grid-template-columns:1fr;}
  .indicator-grid{grid-template-columns:1fr;}
  .tab-nav{overflow-x:auto;}
}
</style>
</head>
<body>

<header>
  <div class="logo-group">
    <div class="logo">CATALYST<span>.AI</span></div>
    <div class="ai-badge">
      <div class="grok-icon">ü§ñ</div>
      <span>POWERED BY GROK</span>
    </div>
  </div>
  <div class="header-right">
    <div class="live">
      <div class="live-dot" id="liveDot"></div>
      <span id="liveLabel">READY</span>
    </div>
    <div class="window-badge" id="headerBadge">‚ö° LAST 60 MIN</div>
  </div>
</header>

<div class="tab-nav">
  <button class="tab-btn active" onclick="switchTab('catalyst')">Catalyst Scanner</button>
  <button class="tab-btn" onclick="switchTab('analysis')">Deep Stock Analysis</button>
  <button class="tab-btn" onclick="switchTab('technical')">Technical Analysis</button>
</div>

<!-- CATALYST TAB -->
<div id="catalystTab" class="tab-content active">
<main>

<div class="grok-banner">
  <div class="grok-avatar">üîç</div>
  <div class="grok-info">
    <div class="grok-title">Catalyst Discovery Engine</div>
    <div class="grok-desc">Real-time monitoring of earnings, FDA approvals, M&A activity, and market-moving events with actual news sources</div>
  </div>
  <div class="grok-status" id="grokStatus1">STANDBY</div>
</div>

<div class="config">
  <div class="section-label">Search Parameters</div>
  <div class="controls">
    <div class="field field-ticker">
      <label>Ticker (Optional)</label>
      <input id="tickerInput1" type="text" placeholder="e.g., AAPL, NVDA or leave blank for all" />
      <div class="field-hint">Enter specific ticker or leave blank to scan all stocks</div>
    </div>
    <div class="field field-sm">
      <label>Time Window</label>
      <select id="windowSelect1">
        <option value="60min">Last 60 Minutes</option>
        <option value="12h">Last 12 Hours</option>
        <option value="1d">Last 1 Day</option>
        <option value="3d">Last 3 Days</option>
        <option value="7d">Last 7 Days</option>
      </select>
    </div>
    <button class="btn-run" id="runBtn1" onclick="runCatalystScan()">üîç Scan Catalysts</button>
  </div>

  <div class="kw-section">
    <div class="kw-section-title">
      <span>Event Categories</span>
      <div class="kw-controls">
        <button class="kw-btn" onclick="toggleAllCatalysts(true)">SELECT ALL</button>
        <button class="kw-btn" onclick="toggleAllCatalysts(false)">CLEAR ALL</button>
      </div>
    </div>
    <div class="kw-grid" id="catalystGrid">
      <div class="chip earn-on" data-kw="earnings">Earnings</div>
      <div class="chip fda-on" data-kw="fda">FDA</div>
      <div class="chip deal-on" data-kw="partnership">Partnerships</div>
      <div class="chip ma-on" data-kw="acquisition">M&A</div>
      <div class="chip macro-on" data-kw="macro">Macro Events</div>
      <div class="chip viral-on" data-kw="viral">Viral/Social</div>
    </div>
  </div>
</div>

<div id="resultsContainer1"></div>

</main>
</div>

<!-- DEEP ANALYSIS TAB -->
<div id="analysisTab" class="tab-content">
<main>

<div class="grok-banner">
  <div class="grok-avatar">üß†</div>
  <div class="grok-info">
    <div class="grok-title">Deep Stock Analysis Engine</div>
    <div class="grok-desc">Comprehensive fundamental analysis ‚Ä¢ Sentiment evaluation ‚Ä¢ Financial metrics ‚Ä¢ Competitive positioning ‚Ä¢ Risk assessment</div>
  </div>
  <div class="grok-status" id="grokStatus2">STANDBY</div>
</div>

<div class="config">
  <div class="section-label">Analysis Parameters</div>
  <div class="controls">
    <div class="field field-ticker">
      <label>Ticker</label>
      <input id="tickerInput2" type="text" placeholder="e.g., AAPL, NVDA" />
      <div class="field-hint">Enter a stock ticker for deep analysis</div>
    </div>
    <div class="field">
      <label>Analysis Window</label>
      <div class="time-toggle">
        <button class="time-opt active" data-days="7">7D</button>
        <button class="time-opt" data-days="30">30D</button>
        <button class="time-opt" data-days="90">90D</button>
      </div>
    </div>
    <button class="btn-run" id="runBtn2" onclick="runDeepAnalysis()">ü§ñ Run Deep Analysis</button>
  </div>
</div>

<div id="resultsContainer2"></div>

</main>
</div>

<!-- TECHNICAL ANALYSIS TAB -->
<div id="technicalTab" class="tab-content">
<main>

<div class="grok-banner">
  <div class="grok-avatar">üìä</div>
  <div class="grok-info">
    <div class="grok-title">Technical Analysis Engine</div>
    <div class="grok-desc">Comprehensive technical indicators ‚Ä¢ Moving averages ‚Ä¢ Momentum analysis ‚Ä¢ Pattern recognition ‚Ä¢ Volume trends ‚Ä¢ Support/Resistance levels</div>
  </div>
  <div class="grok-status" id="grokStatus3">STANDBY</div>
</div>

<div class="config">
  <div class="section-label">Analysis Parameters</div>
  <div class="controls">
    <div class="field field-ticker">
      <label>Ticker Symbol</label>
      <input id="tickerInput3" type="text" placeholder="e.g., AAPL, NVDA" />
      <div class="field-hint">Enter ticker or copy from Deep Analysis tab</div>
    </div>
    <button class="copy-ticker-btn" onclick="copyTickerFromAnalysis()">üìã Copy from Deep Analysis</button>
    <button class="btn-run" id="runBtn3" onclick="runTechnicalAnalysis()">üìà Run Technical Analysis</button>
  </div>
</div>

<div id="resultsContainer3"></div>

</main>
</div>

<script>
// Global variable to store last analyzed ticker
let lastAnalyzedTicker = '';

// Track active analysis tasks
let activeAnalysisTasks = 0;

// Update header status based on active tasks
function updateHeaderStatus() {
  const dot = document.getElementById('liveDot');
  const lbl = document.getElementById('liveLabel');
  
  if(activeAnalysisTasks > 0) {
    dot.classList.add('scanning');
    lbl.textContent = activeAnalysisTasks > 1 ? `ANALYZING (${activeAnalysisTasks})` : 'ANALYZING';
  } else {
    dot.classList.remove('scanning');
    lbl.textContent = 'READY';
  }
}

// Tab switching
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  if(tab === 'catalyst') {
    document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
    document.getElementById('catalystTab').classList.add('active');
  } else if(tab === 'analysis') {
    document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
    document.getElementById('analysisTab').classList.add('active');
  } else if(tab === 'technical') {
    document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
    document.getElementById('technicalTab').classList.add('active');
  }
}

// Copy ticker from Deep Analysis to Technical Analysis
function copyTickerFromAnalysis() {
  if(lastAnalyzedTicker) {
    document.getElementById('tickerInput3').value = lastAnalyzedTicker;
  } else {
    const ticker2 = document.getElementById('tickerInput2').value.trim().toUpperCase();
    if(ticker2) {
      document.getElementById('tickerInput3').value = ticker2;
    } else {
      alert('No ticker found in Deep Analysis tab. Please run a Deep Analysis first or enter ticker manually.');
    }
  }
}

// Catalyst chip toggle
document.getElementById('catalystGrid').addEventListener('click', (e) => {
  if(e.target.classList.contains('chip')) {
    const kw = e.target.dataset.kw;
    const cls = `${kw}-on`;
    e.target.classList.toggle(cls);
  }
});

function toggleAllCatalysts(selectAll) {
  const chips = document.querySelectorAll('#catalystGrid .chip');
  chips.forEach(chip => {
    const kw = chip.dataset.kw;
    const cls = `${kw}-on`;
    if(selectAll) {
      chip.classList.add(cls);
    } else {
      chip.classList.remove(cls);
    }
  });
}

// Time toggle for deep analysis
document.querySelectorAll('.time-opt').forEach(opt => {
  opt.addEventListener('click', () => {
    document.querySelectorAll('.time-opt').forEach(o => o.classList.remove('active'));
    opt.classList.add('active');
  });
});

function getTimeLabel(window) {
  const labels = {
    '60min': '‚ö° LAST 60 MIN',
    '12h': '‚ö° LAST 12 HOURS',
    '1d': '‚ö° LAST 1 DAY',
    '3d': '‚ö° LAST 3 DAYS',
    '7d': '‚ö° LAST 7 DAYS'
  };
  return labels[window] || '‚ö° LIVE';
}

// Catalyst Scan
async function runCatalystScan() {
  const ticker = document.getElementById('tickerInput1').value.trim().toUpperCase() || 'ALL';
  const window = document.getElementById('windowSelect1').value;
  const btn = document.getElementById('runBtn1');
  const rc = document.getElementById('resultsContainer1');
  const dot = document.getElementById('liveDot');
  const lbl = document.getElementById('liveLabel');
  const grokStatus = document.getElementById('grokStatus1');
  
  const selectedCatalysts = Array.from(document.querySelectorAll('#catalystGrid .chip'))
    .filter(chip => {
      const kw = chip.dataset.kw;
      return chip.classList.contains(`${kw}-on`);
    })
    .map(chip => chip.dataset.kw);
  
  if(selectedCatalysts.length === 0) {
    rc.innerHTML = '<div class="err-box">‚ö† Please select at least one catalyst category</div>';
    return;
  }
  
  btn.disabled = true;
  btn.textContent = '‚öôÔ∏è Scanning...';
  activeAnalysisTasks++;
  updateHeaderStatus();
  grokStatus.textContent = 'SCANNING';
  grokStatus.style.cssText = 'background:rgba(255,170,0,.12);border-color:rgba(255,170,0,.3);color:var(--yellow)';
  
  const loadingMsgs = ['Searching latest news...', 'Analyzing market data...', 'Identifying catalysts...', 'Processing events...'];
  let msgIdx = 0;
  const msgTimer = setInterval(() => {
    msgIdx = (msgIdx + 1) % loadingMsgs.length;
  }, 2000);
  
  rc.innerHTML = `<div class="grok-thinking"><span>Grok is searching the latest news</span><div class="thinking-dots"><span></span><span></span><span></span></div></div><div class="state-box"><div class="spinner"></div><div class="loading-msg">${loadingMsgs[0]}</div><div class="state-sub">Analyzing ${ticker} for ${selectedCatalysts.join(', ')} events in ${window}</div></div>`;
  
  document.getElementById('headerBadge').textContent = getTimeLabel(window);
  
  const timeDescriptions = {
    '60min': 'the last 60 minutes',
    '12h': 'the last 12 hours',
    '1d': 'the last 24 hours (1 day)',
    '3d': 'the last 3 days',
    '7d': 'the last 7 days'
  };
  
  const prompt = `You are a financial catalyst scanner with web search capabilities. Use your web search tool to find the LATEST breaking news and catalysts for ${ticker === 'ALL' ? 'all stocks' : ticker} within ${timeDescriptions[window]}.

CRITICAL: You MUST use web search to find real, current news articles published within the specified timeframe.

Focus on these event types: ${selectedCatalysts.join(', ')}.

For each catalyst found, provide:
- ticker: Stock symbol (e.g., "AAPL", "NVDA")
- category: Event type (earnings, fda, partnership, acquisition, macro, viral)
- title: Exact headline from the news article
- summary: 2-3 sentence summary of the news
- impact: Impact score 1-10 (be realistic based on market cap and news significance)
- minutesAgo: Actual time elapsed since publication (in minutes)
- mcap: Market cap in readable format (e.g., "$2.3T", "$45.2B")
- sourceUrl: The FULL URL of the actual news article (REQUIRED - must be a real, clickable link)
- sourceName: Name of the news publication (e.g., "Reuters", "Bloomberg", "CNBC")

IMPORTANT: 
- Use web search to find REAL recent news
- Include actual working URLs from credible sources (Reuters, Bloomberg, CNBC, WSJ, Financial Times, MarketWatch, etc.)
- Focus on very recent events within the time window
- Be selective - only include significant catalysts that could move the stock

Return as JSON with:
- "stats" object: {totalEvents, highImpact (>=7), mediumImpact (4-6), lowImpact (1-3)}
- "catalysts" array: Array of catalyst objects with all fields above

Return ONLY the JSON object, no other text.`;

  try {
    const resp = await fetch("https://api.x.ai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer xai-aWLe02tcvpomdERrIBitgDZ2DCGl1aBypB6oDVEWa0NgJOn8UpQ09h5bS8H3oxEjZYtUR7nMNqzi8S41"
      },
      body: JSON.stringify({
        model: "grok-4-0709",
        messages: [
          { 
            role: "system", 
            content: "You are Grok, a helpful AI with real-time web search capabilities. When asked to find news, you MUST use your web search tool to find current, real articles with actual URLs from credible news sources. Always include working source URLs in your responses."
          },
          { role: "user", content: prompt }
        ],
        temperature: 0.7,
        stream: false
      })
    });

    if (!resp.ok) throw new Error(`API failed: ${resp.status}`);
    
    const data = await resp.json();
    const text = data.choices[0].message.content;
    const jsonMatch = text.match(/\{[\s\S]*\}/);
    if (!jsonMatch) throw new Error("No valid results found");
    
    const result = JSON.parse(jsonMatch[0]);
    
    if (!result.catalysts || result.catalysts.length === 0) {
      throw new Error("No catalysts found in the specified time window");
    }
    
    renderCatalystResults(result);
    
    grokStatus.textContent = 'COMPLETE';
    grokStatus.style.cssText = 'background:rgba(0,255,136,.12);border-color:rgba(0,255,136,.3);color:var(--accent)';
    
  } catch(e) {
    rc.innerHTML = `<div class="err-box">‚ö† ${e.message}</div><div class="state-box"><div class="state-icon">‚ö†Ô∏è</div><div class="state-title">Scan Failed</div><div class="state-sub">${e.message}<br><br>Make sure Grok has web search enabled and try again.</div></div>`;
    grokStatus.textContent = 'ERROR';
    grokStatus.style.cssText = 'background:rgba(255,68,68,.12);border-color:rgba(255,68,68,.3);color:var(--red)';
  } finally {
    clearInterval(msgTimer);
    btn.disabled = false;
    btn.textContent = 'üîç Scan Catalysts';
    activeAnalysisTasks--;
    updateHeaderStatus();
  }
}

function renderCatalystResults(result) {
  const rc = document.getElementById('resultsContainer1');
  rc.innerHTML = '';
  
  // Stats
  const statsDiv = document.createElement('div');
  statsDiv.className = 'stats';
  statsDiv.innerHTML = `
    <div class="stat g"><div class="stat-label">Total Events</div><div class="stat-val">${result.stats.totalEvents}</div></div>
    <div class="stat r"><div class="stat-label">High Impact</div><div class="stat-val">${result.stats.highImpact}</div></div>
    <div class="stat y"><div class="stat-label">Medium Impact</div><div class="stat-val">${result.stats.mediumImpact}</div></div>
    <div class="stat b"><div class="stat-label">Low Impact</div><div class="stat-val">${result.stats.lowImpact}</div></div>
  `;
  rc.appendChild(statsDiv);
  
  // Title
  const title = document.createElement('div');
  title.className = 'results-title';
  title.textContent = 'Catalyst Feed';
  rc.appendChild(title);
  
  // News grid
  const grid = document.createElement('div');
  grid.className = 'news-grid';
  
  result.catalysts.forEach((item, idx) => {
    const impactColor = item.impact >= 7 ? 'var(--red)' : item.impact >= 4 ? 'var(--yellow)' : 'var(--blue)';
    const impactLabel = item.impact >= 7 ? 'HIGH' : item.impact >= 4 ? 'MED' : 'LOW';
    
    const catColors = {
      earnings: 'background:rgba(255,170,0,.12);color:var(--yellow)',
      fda: 'background:rgba(0,255,136,.12);color:var(--accent)',
      partnership: 'background:rgba(68,136,255,.12);color:#77aaff',
      acquisition: 'background:rgba(255,0,110,.12);color:var(--grok)',
      macro: 'background:rgba(147,51,234,.12);color:#9333ea',
      viral: 'background:rgba(255,68,68,.12);color:var(--red)'
    };
    
    // Format time
    const minutesAgo = item.minutesAgo || 0;
    let timeDisplay;
    if (minutesAgo < 60) {
      timeDisplay = `${minutesAgo}m ago`;
    } else if (minutesAgo < 1440) {
      timeDisplay = `${Math.floor(minutesAgo / 60)}h ago`;
    } else {
      timeDisplay = `${Math.floor(minutesAgo / 1440)}d ago`;
    }
    
    const card = document.createElement('div');
    card.className = 'card';
    card.style.animationDelay = `${idx * 0.05}s`;
    card.innerHTML = `
      <div class="card-top">
        <div class="card-tags">
          <span class="ticker-badge">${item.ticker}</span>
          <span class="cat-tag" style="${catColors[item.category] || ''}">${item.category.toUpperCase()}</span>
          <span class="mcap">${item.mcap}</span>
        </div>
      </div>
      <div class="card-title">${item.title}</div>
      <div class="card-summary">${item.summary}</div>
      <div class="card-footer">
        <div class="card-meta">
          <span class="time-ago">${timeDisplay}</span>
          ${item.sourceUrl ? `<span class="sep"></span><a href="${item.sourceUrl}" target="_blank" class="source-link">${item.sourceName || 'Source'} ‚Üí</a>` : ''}
        </div>
        <div class="impact-wrap">
          <span class="impact-label" style="color:${impactColor}">${impactLabel}</span>
          <div class="impact-bar">
            <div class="impact-fill" style="width:${item.impact * 10}%;background:${impactColor}"></div>
          </div>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  
  rc.appendChild(grid);
}

// Deep Analysis
async function runDeepAnalysis() {
  const ticker = document.getElementById('tickerInput2').value.trim().toUpperCase();
  if(!ticker) {
    document.getElementById('resultsContainer2').innerHTML = '<div class="err-box">‚ö† Please enter a ticker symbol</div>';
    return;
  }
  
  // Store ticker for use in technical analysis
  lastAnalyzedTicker = ticker;
  
  const selectedDays = parseInt(document.querySelector('.time-opt.active').dataset.days);
  const btn = document.getElementById('runBtn2');
  const rc = document.getElementById('resultsContainer2');
  const dot = document.getElementById('liveDot');
  const lbl = document.getElementById('liveLabel');
  const grokStatus = document.getElementById('grokStatus2');
  
  btn.disabled = true;
  btn.textContent = '‚öôÔ∏è Analyzing...';
  activeAnalysisTasks++;
  updateHeaderStatus();
  grokStatus.textContent = 'ANALYZING';
  grokStatus.style.cssText = 'background:rgba(255,170,0,.12);border-color:rgba(255,170,0,.3);color:var(--yellow)';
  
  const loadingMsgs = ['Analyzing fundamentals...', 'Evaluating sentiment...', 'Reviewing financials...', 'Assessing competition...', 'Calculating risk metrics...'];
  let msgIdx = 0;
  const msgTimer = setInterval(() => {
    msgIdx = (msgIdx + 1) % loadingMsgs.length;
  }, 2000);
  
  rc.innerHTML = `<div class="grok-thinking"><span>Grok is conducting deep analysis</span><div class="thinking-dots"><span></span><span></span><span></span></div></div><div class="state-box"><div class="spinner"></div><div class="loading-msg">${loadingMsgs[0]}</div><div class="state-sub">Performing comprehensive analysis of ${ticker} over ${selectedDays} days</div></div>`;
  
  const now = new Date();
  const cutoff = new Date(now.getTime() - selectedDays * 86400000);
  const fmt = d => d.toISOString().split('T')[0];
  
  const prompt = `You are an expert financial analyst with web search capabilities. Use web search to perform a comprehensive deep analysis of ${ticker} stock.

Analyze over the last ${selectedDays} days (since ${fmt(cutoff)}).

CRITICAL: Use web search to find CURRENT, ACCURATE data from reliable financial sources.

Provide:

1. SHORT-TERM SENTIMENT (object with category: "Positive/Neutral/Negative", score: -1 to 1, rationale: detailed explanation with recent headlines and events)

2. FINANCIAL METRICS (array of objects with category and value):
- Market Cap
- P/E Ratio
- Profit Margin
- Free Cash Flow
- Debt/Altman Z Score
- Revenue (TTM)
- Shares Outstanding
- Shares Float
- Insider Ownership %
- Institutional Ownership %
- Recent Insider Transactions (3mo)
- Recent Institutional Transactions
- Next Earnings Date
- Earnings Expectations
- Previous Earnings Results
- Top 5 Competitors (with market caps, sorted)

3. DEEP ANALYSIS INSIGHTS (4 sections):
- valuation: Current valuation assessment (2-3 sentences)
- growth: Growth trajectory and drivers (2-3 sentences)
- risks: Key risk factors (2-3 sentences)
- catalysts: Upcoming catalysts (2-3 sentences)

Return as JSON with keys: "shortTermSentiment", "financials", "deepInsights".
Return ONLY JSON, no other text.`;

  try {
    const resp = await fetch("https://api.x.ai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer xai-aWLe02tcvpomdERrIBitgDZ2DCGl1aBypB6oDVEWa0NgJOn8UpQ09h5bS8H3oxEjZYtUR7nMNqzi8S41"
      },
      body: JSON.stringify({
        model: "grok-4-0709",
        messages: [
          { role: "system", content: "You are Grok with web search. Use web search to find current financial data from reliable sources." },
          { role: "user", content: prompt }
        ],
        temperature: 0.7,
        stream: false
      })
    });

    if (!resp.ok) throw new Error(`API failed: ${resp.status}`);
    
    const data = await resp.json();
    const text = data.choices[0].message.content;
    const jsonMatch = text.match(/\{[\s\S]*\}/);
    if (!jsonMatch) throw new Error("No valid results");
    
    const result = JSON.parse(jsonMatch[0]);
    renderDeepAnalysis(result, ticker);
    
    grokStatus.textContent = 'COMPLETE';
    grokStatus.style.cssText = 'background:rgba(0,255,136,.12);border-color:rgba(0,255,136,.3);color:var(--accent)';
    
  } catch(e) {
    rc.innerHTML = `<div class="err-box">‚ö† ${e.message}</div><div class="state-box"><div class="state-icon">‚ö†Ô∏è</div><div class="state-title">Analysis Failed</div><div class="state-sub">${e.message}</div></div>`;
    grokStatus.textContent = 'ERROR';
    grokStatus.style.cssText = 'background:rgba(255,68,68,.12);border-color:rgba(255,68,68,.3);color:var(--red)';
  } finally {
    clearInterval(msgTimer);
    btn.disabled = false;
    btn.textContent = 'ü§ñ Run Deep Analysis';
    activeAnalysisTasks--;
    updateHeaderStatus();
  }
}

function renderDeepAnalysis(result, ticker) {
  const rc = document.getElementById('resultsContainer2');
  rc.innerHTML = '';
  
  // Sentiment
  const sentiment = result.shortTermSentiment;
  const catClass = `sentiment-${sentiment.category.toLowerCase()}`;
  const sentimentSection = document.createElement('div');
  sentimentSection.className = 'sentiment-section';
  sentimentSection.innerHTML = `
    <div class="sentiment-title">Short-Term Sentiment for $${ticker}</div>
    <span class="sentiment-category ${catClass}">${sentiment.category}</span>
    <span class="sentiment-score">Score: ${sentiment.score}</span>
    <div class="sentiment-rationale">${sentiment.rationale}</div>
  `;
  rc.appendChild(sentimentSection);
  
  // Deep insights
  if(result.deepInsights) {
    const insightsTitle = document.createElement('div');
    insightsTitle.className = 'results-title';
    insightsTitle.textContent = 'Deep Analysis';
    insightsTitle.style.marginTop = '20px';
    rc.appendChild(insightsTitle);
    
    const grid = document.createElement('div');
    grid.className = 'analysis-grid';
    
    const sections = [
      { key: 'valuation', title: 'Valuation Assessment', icon: 'üìä' },
      { key: 'growth', title: 'Growth Analysis', icon: 'üìà' },
      { key: 'risks', title: 'Risk Factors', icon: '‚ö†Ô∏è' },
      { key: 'catalysts', title: 'Upcoming Catalysts', icon: 'üöÄ' }
    ];
    
    sections.forEach(section => {
      const card = document.createElement('div');
      card.className = 'analysis-card';
      card.innerHTML = `
        <div class="analysis-card-title">${section.icon} ${section.title}</div>
        <div class="analysis-content">${result.deepInsights[section.key] || 'No data available'}</div>
      `;
      grid.appendChild(card);
    });
    
    rc.appendChild(grid);
  }
  
  // Financials
  const financialTitle = document.createElement('div');
  financialTitle.className = 'results-title';
  financialTitle.textContent = 'Financial Metrics';
  financialTitle.style.marginTop = '20px';
  rc.appendChild(financialTitle);
  
  const table = document.createElement('table');
  table.className = 'financial-table';
  table.innerHTML = '<thead><tr><th>Category</th><th>Value/Details</th></tr></thead><tbody></tbody>';
  const tbody = table.querySelector('tbody');
  
  result.financials.forEach(item => {
    const row = document.createElement('tr');
    row.innerHTML = `<td>${item.category}</td><td>${item.value}</td>`;
    tbody.appendChild(row);
  });
  
  rc.appendChild(table);
}

// Technical Analysis
async function runTechnicalAnalysis() {
  const ticker = document.getElementById('tickerInput3').value.trim().toUpperCase();
  if(!ticker) {
    document.getElementById('resultsContainer3').innerHTML = '<div class="err-box">‚ö† Please enter a ticker symbol</div>';
    return;
  }
  
  const btn = document.getElementById('runBtn3');
  const rc = document.getElementById('resultsContainer3');
  const dot = document.getElementById('liveDot');
  const lbl = document.getElementById('liveLabel');
  const grokStatus = document.getElementById('grokStatus3');
  
  btn.disabled = true;
  btn.textContent = '‚öôÔ∏è Analyzing...';
  activeAnalysisTasks++;
  updateHeaderStatus();
  grokStatus.textContent = 'ANALYZING';
  grokStatus.style.cssText = 'background:rgba(255,170,0,.12);border-color:rgba(255,170,0,.3);color:var(--yellow)';
  
  rc.innerHTML = `<div class="grok-thinking"><span>Grok is performing technical analysis</span><div class="thinking-dots"><span></span><span></span><span></span></div></div><div class="state-box"><div class="spinner"></div><div class="loading-msg">Analyzing technical indicators...</div><div class="state-sub">Calculating SMA/EMA, RSI, MACD, Bollinger Bands, and more for ${ticker}</div></div>`;
  
  const prompt = `You are an expert technical analyst with web search capabilities. Perform a comprehensive technical analysis for ${ticker} stock.

Use web search to find CURRENT price data, technical indicators, and market data from reliable financial sources.

Provide detailed analysis including:

1. TREND OVERVIEW:
- overallTrend: "Bullish", "Bearish", or "Neutral"
- currentPrice: Current stock price
- priceChange24h: Price change in last 24h (percentage)
- trendStrength: "Strong", "Moderate", or "Weak"

2. MOVING AVERAGES:
- sma9: Simple Moving Average 9-day value and position relative to price
- sma21: Simple Moving Average 21-day value
- sma50: Simple Moving Average 50-day value
- sma200: Simple Moving Average 200-day value
- ema9: Exponential Moving Average 9-day value
- ema21: Exponential Moving Average 21-day value
- signal: "Bullish" (price above MAs, golden cross), "Bearish" (price below MAs, death cross), or "Neutral"
- interpretation: Detailed explanation (2-3 sentences)

3. 52-WEEK RANGE:
- low52week: 52-week low price
- high52week: 52-week high price
- currentPosition: Where current price sits in the range (percentage)
- interpretation: Brief analysis

4. VOLUME ANALYSIS:
- avgVolume: Average daily volume
- recentVolume: Recent volume trend
- volumeChange: Percentage change vs average
- signal: "Increasing" or "Decreasing"
- buyingSentiment: "Strong Buy Pressure", "Moderate", or "Weak"
- interpretation: Analysis of volume trends (2-3 sentences)

5. SUPPORT & RESISTANCE (3-5 days):
- supportLevels: Array of support price levels
- resistanceLevels: Array of resistance price levels
- nearestSupport: Closest support level
- nearestResistance: Closest resistance level
- interpretation: Brief explanation

6. RSI (Relative Strength Index):
- value: Current RSI value (0-100)
- signal: "Overbought" (>70), "Oversold" (<30), "Neutral"
- divergence: Any bullish/bearish divergence noted
- interpretation: Analysis (2-3 sentences)

7. STOCHASTIC:
- kValue: %K value
- dValue: %D value
- signal: "Overbought", "Oversold", or "Neutral"
- interpretation: Short-term reversal signals

8. ATR (Average True Range):
- value: ATR value
- volatility: "High", "Medium", or "Low"
- stopLossSuggestion: Suggested stop loss based on ATR

9. VWAP:
- value: Volume Weighted Average Price
- position: "Above VWAP" (accumulation) or "Below VWAP" (distribution)
- signal: "Bullish" or "Bearish"
- interpretation: Institutional activity analysis

10. RELATIVE STRENGTH:
- vsSPY: Performance vs S&P 500 (percentage)
- signal: "Outperforming" or "Underperforming"
- interpretation: Relative strength analysis

11. MARKET STRUCTURE & PATTERNS:
- structure: "Higher Highs & Higher Lows" (Uptrend), "Lower Highs & Lower Lows" (Downtrend), or "Sideways"
- patterns: Array of identified patterns (e.g., "Bull Flag", "Cup & Handle", "Ascending Triangle", "Head & Shoulders", "Double Bottom/Top")
- interpretation: Pattern analysis

12. CATALYST ALIGNMENT:
- technicalSetup: Quality of technical setup (1-10)
- upcomingCatalysts: Any known catalysts (earnings, news, events)
- probability: "High Probability Setup" or "Low Probability Setup"
- interpretation: How technicals align with catalysts

13. OVERALL SUMMARY:
- trend: Final trend determination
- recommendation: "Strong Buy", "Buy", "Hold", "Sell", or "Strong Sell"
- confidence: Confidence level (1-10)
- keyTakeaways: Array of 3-5 key insights
- riskLevel: "High", "Medium", or "Low"

Return as JSON with all the sections above.
Return ONLY JSON, no other text.`;

  try {
    const resp = await fetch("https://api.x.ai/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer xai-aWLe02tcvpomdERrIBitgDZ2DCGl1aBypB6oDVEWa0NgJOn8UpQ09h5bS8H3oxEjZYtUR7nMNqzi8S41"
      },
      body: JSON.stringify({
        model: "grok-4-0709",
        messages: [
          { role: "system", content: "You are Grok with web search. Use web search to find current technical data from reliable financial sources." },
          { role: "user", content: prompt }
        ],
        temperature: 0.7,
        stream: false
      })
    });

    if (!resp.ok) throw new Error(`API failed: ${resp.status}`);
    
    const data = await resp.json();
    const text = data.choices[0].message.content;
    const jsonMatch = text.match(/\{[\s\S]*\}/);
    if (!jsonMatch) throw new Error("No valid results");
    
    const result = JSON.parse(jsonMatch[0]);
    renderTechnicalAnalysis(result, ticker);
    
    grokStatus.textContent = 'COMPLETE';
    grokStatus.style.cssText = 'background:rgba(0,255,136,.12);border-color:rgba(0,255,136,.3);color:var(--accent)';
    
  } catch(e) {
    rc.innerHTML = `<div class="err-box">‚ö† ${e.message}</div><div class="state-box"><div class="state-icon">‚ö†Ô∏è</div><div class="state-title">Analysis Failed</div><div class="state-sub">${e.message}</div></div>`;
    grokStatus.textContent = 'ERROR';
    grokStatus.style.cssText = 'background:rgba(255,68,68,.12);border-color:rgba(255,68,68,.3);color:var(--red)';
  } finally {
    btn.disabled = false;
    btn.textContent = 'üìà Run Technical Analysis';
    activeAnalysisTasks--;
    updateHeaderStatus();
  }
}

function renderTechnicalAnalysis(result, ticker) {
  const rc = document.getElementById('resultsContainer3');
  rc.innerHTML = '';
  
  // Overall Summary Card
  if(result.overallSummary) {
    const summaryCard = document.createElement('div');
    summaryCard.className = 'summary-card';
    const trendClass = result.overallSummary.trend === 'Bullish' ? 'signal-bullish' : 
                        result.overallSummary.trend === 'Bearish' ? 'signal-bearish' : 'signal-neutral';
    summaryCard.innerHTML = `
      <div class="summary-card-title">üìä Overall Technical Analysis: $${ticker}</div>
      <div class="summary-content">
        <strong>Trend:</strong> <span class="trend-badge ${trendClass}">${result.overallSummary.trend}</span><br>
        <strong>Recommendation:</strong> ${result.overallSummary.recommendation} (Confidence: ${result.overallSummary.confidence}/10)<br>
        <strong>Risk Level:</strong> ${result.overallSummary.riskLevel}<br><br>
        <strong>Key Takeaways:</strong>
        <ul style="margin-top:8px;padding-left:20px;">
          ${result.overallSummary.keyTakeaways.map(t => `<li>${t}</li>`).join('')}
        </ul>
      </div>
    `;
    rc.appendChild(summaryCard);
  }
  
  // Trend Overview
  if(result.trendOverview) {
    const overview = document.createElement('div');
    overview.className = 'technical-overview';
    const trendClass = result.trendOverview.overallTrend === 'Bullish' ? 'bullish' : 
                        result.trendOverview.overallTrend === 'Bearish' ? 'bearish' : 'neutral';
    overview.innerHTML = `
      <div class="technical-card">
        <div class="technical-card-title">Current Price</div>
        <div class="technical-value ${trendClass}">$${result.trendOverview.currentPrice}</div>
        <div class="technical-subtitle">${result.trendOverview.priceChange24h}</div>
      </div>
      <div class="technical-card">
        <div class="technical-card-title">Overall Trend</div>
        <div class="technical-value ${trendClass}">${result.trendOverview.overallTrend}</div>
        <div class="technical-subtitle">${result.trendOverview.trendStrength} Strength</div>
      </div>
      <div class="technical-card">
        <div class="technical-card-title">52-Week Range</div>
        <div class="technical-value" style="font-size:20px;color:var(--text);">${result.weekRange52?.low52week} - ${result.weekRange52?.high52week}</div>
        <div class="technical-subtitle">${result.weekRange52?.currentPosition} of range</div>
      </div>
    `;
    rc.appendChild(overview);
  }
  
  // Moving Averages
  if(result.movingAverages) {
    const maCard = createIndicatorCard('Moving Averages (SMA/EMA)', result.movingAverages.signal, [
      { name: 'SMA 9', value: result.movingAverages.sma9 },
      { name: 'SMA 21', value: result.movingAverages.sma21 },
      { name: 'SMA 50', value: result.movingAverages.sma50 },
      { name: 'SMA 200', value: result.movingAverages.sma200 },
      { name: 'EMA 9', value: result.movingAverages.ema9 },
      { name: 'EMA 21', value: result.movingAverages.ema21 }
    ], result.movingAverages.interpretation);
    rc.appendChild(maCard);
  }
  
  // Create indicator grid for momentum indicators
  const indicatorGrid = document.createElement('div');
  indicatorGrid.className = 'indicator-grid';
  
  // RSI
  if(result.rsi) {
    const rsiCard = createIndicatorCard('RSI (Relative Strength Index)', result.rsi.signal, [
      { name: 'RSI Value', value: result.rsi.value },
      { name: 'Divergence', value: result.rsi.divergence || 'None' }
    ], result.rsi.interpretation);
    indicatorGrid.appendChild(rsiCard);
  }
  
  // Stochastic
  if(result.stochastic) {
    const stochCard = createIndicatorCard('Stochastic Oscillator', result.stochastic.signal, [
      { name: '%K Value', value: result.stochastic.kValue },
      { name: '%D Value', value: result.stochastic.dValue }
    ], result.stochastic.interpretation);
    indicatorGrid.appendChild(stochCard);
  }
  
  // Volume Analysis
  if(result.volumeAnalysis) {
    const volCard = createIndicatorCard('Volume Analysis', result.volumeAnalysis.signal, [
      { name: 'Avg Volume', value: result.volumeAnalysis.avgVolume },
      { name: 'Recent Trend', value: result.volumeAnalysis.recentVolume },
      { name: 'Change', value: result.volumeAnalysis.volumeChange },
      { name: 'Sentiment', value: result.volumeAnalysis.buyingSentiment }
    ], result.volumeAnalysis.interpretation);
    indicatorGrid.appendChild(volCard);
  }
  
  // ATR
  if(result.atr) {
    const atrCard = createIndicatorCard('ATR (Average True Range)', result.atr.volatility, [
      { name: 'ATR Value', value: result.atr.value },
      { name: 'Volatility', value: result.atr.volatility },
      { name: 'Stop Loss Suggestion', value: result.atr.stopLossSuggestion }
    ], 'ATR helps determine appropriate stop-loss levels based on current volatility.');
    indicatorGrid.appendChild(atrCard);
  }
  
  // VWAP
  if(result.vwap) {
    const vwapCard = createIndicatorCard('VWAP (Volume Weighted Avg Price)', result.vwap.signal, [
      { name: 'VWAP Value', value: result.vwap.value },
      { name: 'Position', value: result.vwap.position }
    ], result.vwap.interpretation);
    indicatorGrid.appendChild(vwapCard);
  }
  
  // Relative Strength
  if(result.relativeStrength) {
    const rsCard = createIndicatorCard('Relative Strength vs SPY', result.relativeStrength.signal, [
      { name: 'vs S&P 500', value: result.relativeStrength.vsSPY }
    ], result.relativeStrength.interpretation);
    indicatorGrid.appendChild(rsCard);
  }
  
  rc.appendChild(indicatorGrid);
  
  // Support & Resistance
  if(result.supportResistance) {
    const srSection = document.createElement('div');
    srSection.className = 'pattern-section';
    srSection.innerHTML = `
      <div class="pattern-title">üìç Support & Resistance Levels (3-5 Days)</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:12px;">
        <div>
          <div style="font-family:'DM Mono';font-size:11px;color:var(--accent);margin-bottom:8px;">SUPPORT LEVELS</div>
          ${result.supportResistance.supportLevels.map(level => 
            `<div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.04);color:#7a80a0;">$${level}</div>`
          ).join('')}
          <div style="margin-top:12px;font-family:'DM Mono';font-size:11px;color:var(--muted);">Nearest: $${result.supportResistance.nearestSupport}</div>
        </div>
        <div>
          <div style="font-family:'DM Mono';font-size:11px;color:var(--red);margin-bottom:8px;">RESISTANCE LEVELS</div>
          ${result.supportResistance.resistanceLevels.map(level => 
            `<div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,.04);color:#7a80a0;">$${level}</div>`
          ).join('')}
          <div style="margin-top:12px;font-family:'DM Mono';font-size:11px;color:var(--muted);">Nearest: $${result.supportResistance.nearestResistance}</div>
        </div>
      </div>
      <div style="margin-top:12px;font-size:13px;color:#7a80a0;line-height:1.65;">${result.supportResistance.interpretation}</div>
    `;
    rc.appendChild(srSection);
  }
  
  // Market Structure & Patterns
  if(result.marketStructure) {
    const patternSection = document.createElement('div');
    patternSection.className = 'pattern-section';
    patternSection.innerHTML = `
      <div class="pattern-title">üìê Market Structure & Pattern Recognition</div>
      <div style="margin-bottom:12px;font-size:14px;color:#dde0ea;">
        <strong>Structure:</strong> ${result.marketStructure.structure}
      </div>
      ${result.marketStructure.patterns && result.marketStructure.patterns.length > 0 ? `
        <div style="font-family:'DM Mono';font-size:11px;color:var(--muted);margin-bottom:8px;">IDENTIFIED PATTERNS:</div>
        <ul class="pattern-list">
          ${result.marketStructure.patterns.map(pattern => 
            `<li class="pattern-item"><span class="pattern-icon">üìä</span>${pattern}</li>`
          ).join('')}
        </ul>
      ` : ''}
      <div style="margin-top:12px;font-size:13px;color:#7a80a0;line-height:1.65;">${result.marketStructure.interpretation}</div>
    `;
    rc.appendChild(patternSection);
  }
  
  // Catalyst Alignment
  if(result.catalystAlignment) {
    const catalystSection = document.createElement('div');
    catalystSection.className = 'pattern-section';
    catalystSection.innerHTML = `
      <div class="pattern-title">üéØ Catalyst + Technical Alignment</div>
      <div style="display:flex;gap:20px;margin-bottom:12px;">
        <div>
          <div style="font-family:'DM Mono';font-size:11px;color:var(--muted);margin-bottom:4px;">Technical Setup Quality</div>
          <div style="font-family:'Bebas Neue';font-size:28px;color:var(--accent);">${result.catalystAlignment.technicalSetup}/10</div>
        </div>
        <div style="flex:1;">
          <div style="font-family:'DM Mono';font-size:11px;color:var(--muted);margin-bottom:4px;">Probability</div>
          <div style="font-size:14px;color:#dde0ea;">${result.catalystAlignment.probability}</div>
        </div>
      </div>
      ${result.catalystAlignment.upcomingCatalysts ? `
        <div style="margin-bottom:8px;">
          <div style="font-family:'DM Mono';font-size:11px;color:var(--muted);margin-bottom:4px;">UPCOMING CATALYSTS</div>
          <div style="font-size:13px;color:#7a80a0;">${result.catalystAlignment.upcomingCatalysts}</div>
        </div>
      ` : ''}
      <div style="font-size:13px;color:#7a80a0;line-height:1.65;">${result.catalystAlignment.interpretation}</div>
    `;
    rc.appendChild(catalystSection);
  }
  
  // TradingView Charts
  const chartSection = document.createElement('div');
  chartSection.className = 'chart-container';
  chartSection.innerHTML = `
    <div class="chart-header">
      <div class="chart-title">TradingView Chart</div>
      <div class="time-toggle" id="chartTimeToggle">
        <button class="time-opt active" data-interval="W" data-label="1 Week">1W</button>
        <button class="time-opt" data-interval="D" data-label="30 Days">1M</button>
        <button class="time-opt" data-interval="180" data-label="6 Months">6M</button>
        <button class="time-opt" data-interval="365" data-label="1 Year">1Y</button>
      </div>
    </div>
    <div class="chart-embed" id="mainChart" style="height:600px;">
      <iframe id="chartIframe" src="https://www.tradingview.com/embed-widget/advanced-chart/?symbol=${ticker}&interval=W&theme=dark&style=1&locale=en&hide_top_toolbar=false&hide_side_toolbar=false&allow_symbol_change=true&save_image=false&calendar=false&hide_volume=false&support_host=https%3A%2F%2Fwww.tradingview.com"></iframe>
    </div>
  `;
  rc.appendChild(chartSection);
  
  // Add event listeners to chart time toggle buttons
  document.querySelectorAll('#chartTimeToggle .time-opt').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#chartTimeToggle .time-opt').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const interval = btn.dataset.interval;
      const iframe = document.getElementById('chartIframe');
      iframe.src = `https://www.tradingview.com/embed-widget/advanced-chart/?symbol=${ticker}&interval=${interval}&theme=dark&style=1&locale=en&hide_top_toolbar=false&hide_side_toolbar=false&allow_symbol_change=true&save_image=false&calendar=false&hide_volume=false&support_host=https%3A%2F%2Fwww.tradingview.com`;
    });
  });
}

function createIndicatorCard(name, signal, metrics, interpretation) {
  const card = document.createElement('div');
  card.className = 'indicator-card';
  
  let signalClass = 'signal-neutral';
  if(signal && (signal.toLowerCase().includes('bullish') || signal.toLowerCase().includes('buy') || signal === 'Outperforming' || signal === 'Increasing')) {
    signalClass = 'signal-bullish';
  } else if(signal && (signal.toLowerCase().includes('bearish') || signal.toLowerCase().includes('sell') || signal === 'Underperforming' || signal === 'Decreasing')) {
    signalClass = 'signal-bearish';
  }
  
  card.innerHTML = `
    <div class="indicator-header">
      <div class="indicator-name">${name}</div>
      <div class="indicator-signal ${signalClass}">${signal || 'N/A'}</div>
    </div>
    <div class="indicator-details">
      ${metrics.map(m => `
        <div class="indicator-metric">
          <span class="metric-name">${m.name}</span>
          <span class="metric-val">${m.value}</span>
        </div>
      `).join('')}
      ${interpretation ? `<div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.04);font-size:12px;line-height:1.6;">${interpretation}</div>` : ''}
    </div>
  `;
  
  return card;
}
</script>
</body>
</html>
